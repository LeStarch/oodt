<!-- Tree view template -->
<script type="text/template" id="template-jstree">
    <div id="<%= name %>" class="treeview">
    </div>
</script>
<!-- Upload template -->
<script type="text/template" id="template-upload">
    <div id="<%= name %>" class="upload dropzone"></div>
</script>
<!-- An input record for use within the table -->
<script type="text/template" id="template-input">
    <% var disabled = ("locked" in record && record.locked) ? "disabled" : "";
       var toDisp = "display" in record?record.display:record.values;
       if ("choices" in record) { %>
           <select name="<%= record.name %>" <%= disabled %>>
    <%     for (var i = 0; i < record.choices.length; i++) { %>
               <option value="<%= record.choices[i]%>"><%= record.choices[i]%></option>
    <%     }; %>
           </select>
    <% } else { %>
           <input type="text" name="<%= record.name %>" value="<%= toDisp.join()%>" <%= disabled %> ></input>
    <% }; %>
</script>

<!-- An element -->
<script type="text/template" id="template-table-element">
    <% var disabled = locked ? "disabled" : "";
       if (values != null) { %>
           <select id="<%= name %>" name="<%= name %>" <%= disabled %>>
    <%     for (var i = 0; i < values.length; i++) {
               var selected = values[i] == value ? "selected" : ""; %>
               <option value="<%= values[i]%>" <%= selected %>><%= values[i]%></option>
    <%     }; %>
           </select>
    <% } else { %>
           <input type="text" name="<%= name %>" value="<%= value %>" <%= disabled %> ></input>
    <% }; %>
</script>
<!-- Extractors list template -->
<script type="text/template" id="template-extractor-list">
    Extractor:
    <select id="extractors">
        <option name="No Extractor" value="No Extractor">No Extractor</option>
    <% var extractors = model.get("extractors");
       for (var i = 0; i < extractors.length; i++) { 
           var selected = (model.get("selected") == extractors[i]) ? "selected" : ""; %>
           <option name="<%= extractors[i] %>" value="<%= extractors[i] %>" <%= selected %>><%= extractors[i] %></option>
    <% }; %>
    </select>
</script>

<!-- Table Metadata -->
<script type="text/template" id="template-elements-table">
    <table class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Metadata Key</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
    <%      for (var i = 0; i < htmls.length; i++) { %>
                <tr>
                    <td><%= htmls[i].name %></td>
                    <td><%= htmls[i].html  %></td>
                </tr>
    <!-- TODO: Insert recursion here, if needed -->
    <%      }; %>
        </tbody>
        <button id="ingest" class="btn btn-success">Ingest Current Selection</button>
    </table>
</script>


<!-- A table for metadata key/vals -->
<script type="text/template" id="template-table">
    <% var extractorSelectHtml = _.template($("script#template-extractor-list").html())({"extractors":extractors}); %>
    <%= extractorSelectHtml %>
    <% function recurseFn(sub) { %>
           <table class="display" cellspacing="0" width="100%">
               <thead>
                   <tr>
                       <th>Metadata Key</th>
                       <th>Value</th>
                   </tr>
               </thead>
               <tbody>
    <%             for (var key in sub.children) { 
                       var child = sub.children[key];
                       var disabled = (typeof(child.locked) == "undefined" || !child.locked) ? "" : "disabled";
                       var inputHtml = _.template($("script#template-input").html())({"record":child}); %>
                       <tr>
                           <td><%= child.name %></td>
                           <td><%= inputHtml %></td>
                       </tr>
    <%                 if (Object.keys(child.children).length != 0) { %>
                           <tr>
                               <td><%recurseFn(child);%></td>
                           </tr>
    <%                 };
                   }; %>
               </tbody>
           </table>
    <% };
       recurseFn(object);%>
    <button id="ingest" class="btn btn-success">Ingest Current Selection</button>
</script>
<!-- Ingest file template -->
<script type="text/template" id="template-ingesting">
    <ul id="ingestable">
    <%    if (statuses.length == 0) { %>
              <h3>No ingesting products</h3>
    <%    } else {
              for (var i = 0; i < statuses.length; i++) {
                  var model = statuses[i];
                  var icon = "icons/error.jpg";
                  var extra = "";
                  if (model.status == "DONE") {
                      icon = "icons/success.jpg";
                      var location = "/opsui/product/"+statuses[i].product;
                      extra = "<em>Metadata record:<a href='"+location+"'>"+statuses[i].product+"</a></em>";
                  } else if (model.status == "IN PROGRESS") {
                      icon = "icons/waiting.gif";
                  } else {
                      extra = "<em>"+model.status+"</em>";
                  }%>
                  <li><img src="<%= icon %>" height="20px" /><%= model.file %><br><%= extra %></li>
    <%        }; 
          }; %>
    </ul>
</script>
